<script>
Ext.onReady(function(){
    var teamCombox = new SettCombbox({
        url:'/ams/Info/TeamList?ID=1&Type=2&All=0',
        fieldLabel: '营业班组',
        anchor:'95%',
        id:'team',
        hiddenName:'Team',
        autoLoad:true
    });

    var infoSearch = new Ext.FormPanel({
        title: '查询条件',
        defaults:{
            border: false
        },
        labelAlign: 'right',
        style: 'padding-top:10px',
        layout:'column',
        items: [{
            columnWidth:.25,
            layout: 'form',
            defaults:{
                xtype: 'textfield'
            },
            items: [
                teamCombox]
        },{
            columnWidth:.25,
            layout: 'form',
            defaults:{
                xtype: 'textfield'
            },
            items: [
                {
                    xtype: 'compositefield',
                    fieldLabel: '收费时间',
                    defaults:{
                        xtype: 'datefield'
                    },
                    items:[
                        {
                            xtype:'datetimefield',
                            value:new Date(new Date()-7*24*60*60*1000),
                            format: 'Y-m-d H:i',
                            name:'FromData',
                            width: 82
                        },{
                            xtype: 'displayfield',
                            value: '至: '
                        },{
                            xtype:'datetimefield',
                            format: 'Y-m-d H:i',
                            name:'ToData',
                            value:new Date().format('Y-m-d H:i:s'),
                            width: 82
                        }]
                }
            ]
        },{
            columnWidth:.25,
            layout: 'form',
            items:[{
                width:100,
                xtype:'button',
                text:'查询',
                handler:function(){
                    var data = infoSearch.getForm().getValues();
                    listView.store.load({
                        params : data,
                        add: false
                    });
                }
            }]
        }]
    });

    var searchTab = new Ext.TabPanel({
        labelWidth: 85,
        activeTab: 0,
        height:70,
        plain:true,
        defaults:{autoScroll: true},
        items:[
            infoSearch
        ]
    });

    var store = new Ext.data.JsonStore(
            {
                url: '/ams/CountSearch/Reconciliation',
                root: 'data',
                fields: summaryFields
            });

    var listView = new Ext.grid.GridPanel({
        store: store,
        multiSelect: true,
        title: '汇总信息',
        stripeRows: true,
        //region: 'center'
        autoHeight:true,
        emptyText: '没有数据',
        reserveScrollOffset: true,
        viewConfig: {forceFit:true},
        columns: [{
            header: '收费班组',
            sortable: true,
            align:"center",
            dataIndex: 'ChargeTeam'
        }, {
            header: '管理班组',
            dataIndex: 'Team',
            align:"center",
            sortable: true
        }, {
            header: '电费年份',
            sortable: true,
            align:"center",
            dataIndex: 'Year'
        }, {
            header: '收费笔数',
            sortable: true,
            align:"center",
            dataIndex: 'ChargeCount'
        }, {
            header: '收费金额',
            sortable: true,
            align:"center",
            dataIndex: 'Money'
        }],
        bbar: [{
         text: 'excel',
         ref:'../canCel',
         iconCls: 'excel'
         }]
    });

    var infoPanel = new Ext.TabPanel({
        labelWidth: 85,
        activeTab: 0,
        plain:true,
        style: 'margin-top:15px',
        defaults:{autoScroll: true},
        items:[
            listView
        ]
    });


    var formpanels = new Ext.Panel({
        region: 'center',
        fileUpload: true,
        autoScroll: true,
        bodyStyle: "padding:20px;",
        items: [
            searchTab,
            infoPanel

        ]
    });


    new Ext.Viewport(
            {
                layout: 'border',
                items: [
                    formpanels
                ]
            });
})
</script>
