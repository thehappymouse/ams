
<?php
$this->pageTitle = "系统设置";
?>
<script type="text/javascript">

Ext.onReady(function () {
    var ds = new Ext.data.Store({
        url: 'index.php?r=weather/search',
        reader: new Ext.data.JsonReader({
            root: 'citys',
            totalProperty: 'totalCount',
            id: 'CityID'
        }, [
            {name: 'CityID'},
            {name: 'City'},
            {name: 'CityEn'},
            {name: 'Area'}
        ])
    });
    var resultTpl = new Ext.XTemplate(
            '<tpl for="."><div class="search-item" style="margin:2px 0px;">',
            '<div style="padding:5px;">',
            '<span >{City}</span><span>({CityEn}) {Area}</span>',
            '</div>',
            '</div></tpl>'
    );

    var ManagerSignature = new Ext.TabPanel({
        labelWidth: 85,
        activeTab: 0,
        height:150,
        plain:true,
        region: 'center',
        style: 'margin-top:15px',
        defaults:{autoScroll: true},
        items:[{
            title: '用户信息',
            labelAlign: 'right',
            defaults:{
                border: false
            },
            style: 'margin-top:10px',
            layout:'column',
            items: [
                {
                    columnWidth:.3,
                    layout: 'form',
                    defaults:{
                        xtype: 'textfield',
                        readOnly:true
                    },
                    items: [{
                        fieldLabel: '用户名称',
                        name: 'Name',
                        anchor:'95%'
                    }, {
                        fieldLabel: '抄表段编号',
                        name: 'Segment',
                        anchor:'95%'
                    },{
                        fieldLabel: '停电标志',
                        name: 'IsCut',
                        anchor:'95%'
                    },{
                        fieldLabel: '房东电话',
                        name: 'LandlordPhone',
                        anchor:'95%'
                    }]
                },{
                    columnWidth:.3,
                    layout: 'form',
                    defaults:{
                        xtype: 'textfield',
                        readOnly:true
                    },
                    items: [{
                        fieldLabel: '用户编号',
                        name: 'Number',
                        anchor:'95%'
                    },{
                        fieldLabel: '用电地址',
                        name: 'Address',
                        anchor:'95%'
                    },{
                        fieldLabel: '停电方式',
                        name: 'CutStyle',
                        anchor:'95%'
                    }]
                },{
                    columnWidth:.3,
                    layout: 'form',
                    defaults:{
                        xtype: 'textfield',
                        readOnly:true
                    },
                    items: [{
                        fieldLabel: '管理班组',
                        name: 'Team',
                        anchor:'95%'
                    },{
                        fieldLabel: '抄表员',
                        name: 'SegUser',
                        anchor:'95%'
                    },{
                        fieldLabel: '租房户',
                        name: 'IsRent',
                        anchor:'95%'
                    }]
                }]
        }
        ]
    });


    var PowerVideo = new Ext.TabPanel({
        labelWidth: 85,
        activeTab: 0,
        height:145,
        plain:true,
        style: 'margin-top:15px',
        defaults:{autoScroll: true},
        items:[{
            xtype: 'panel',
            title: '收费',
            style: 'margin-top:6px;margin-left:20px',
            labelAlign: 'right',
            //defaultType: 'textfield',
            layout: 'form',
            items: [{
                fieldLabel: '<a style="color:red;">*</a>收费金额',
                xtype: 'textfield',
                width: 151
            },{
                xtype: 'compositefield',
                items: [
                    {
                        xtype: 'textfield',
                        name: 'StandbyImg',
                        fieldLabel: '房东电话',
                        readOnly: true,
                        width: 151
                    }, {
                        xtype: 'displayfield',
                        value: '房客电话:'
                    }, {
                        xtype: 'textfield'
                    }]
            },
                new Ext.form.ComboBox({
                    store: new Ext.data.ArrayStore({
                        fields: ['abbr', 'state', 'nick'],
                        data : [
                            ['AL', '是', 'The Heart of Dixie'],
                            ['CT', '否', 'The Constitution State']]
                    }),
                    fieldLabel: '签订费控协议',
                    displayField:'state',
                    typeAhead: true,
                    mode: 'local',
                    forceSelection: true,
                    triggerAction: 'all',
                    width: 151,
                    selectOnFocus:true
                })/*,
                 {
                 xtype: 'button',
                 width: 90,
                 style:'margin-left:30px',
                 text: '提交'

                 }*/,{
                    html:'<button id="button1" style="margin-left:45px;border:#00a6a1 1px solid;background-image:url(../www/images/default/button/button-mid.gif);color:#004648">提交</button>'
                }
            ]
        }]
    });


    var searchPanel= new Ext.TabPanel({
        labelWidth: 85,
        activeTab: 0,
        height:65,
        plain:true,
        bodyStyle: 'padding:6px',
        defaults:{autoScroll: true},
        items:[{
            title: '用户查询',
            xtype: 'panel',
            items: [{
                xtype: 'compositefield',
                width:500,
                items: [
                    {
                        xtype: 'displayfield',
                        style: 'text-align:right;width:85px;',
                        value: '<a style="color:red;">*</a>用户编号: '
                    },
                    {
                        xtype: 'textfield',
                        id:'searchNumber',
                        width: 220
                    },
                    {
                        /*xtype: 'button',
                         width: 80,
                        style:"border:#00a6a1 1px solid;background-image:url(../www/images/default/button/button-mid.gif);color:#004648",
                         text: '查询'*/
                        html:'<button id="button2" style="border:#00a6a1 1px solid;cursor:pointer;background-image:url(../www/images/default/button/button-mid.gif);color:#004648">查询</button>',
                        listeners : {
                            render : function() {//渲染后添加click事件
                                Ext.fly(this.el).on('click',
                                        function(e, t) {
                                            var number = Ext.getCmp('searchNumber').getValue();
                                            ManagerSignature.getItem(0).load({
                                                url:'/ams/Charges/Customer?ID='+number
                                            })
                                            store.load({
                                                url:'/ams/info/UserList?ID='+number
                                            })
                                           // console.log(number);
                                        }
                                );
                            }
                        }
                    }
                ]
            }]
        }
        ]
    });


    function winIframe(url, b, h) {
        if (h == 1) {
            h = 500;
        }
        var win = new Ext.Window({
            width: h,
            height: 400,

            modal: true,
            html: "<iframe src=" + url + " frameborder='no' width='100%' scrolling='no' height='100%' />",
            title: b.text
        });
        win.show();
    }
     /** 电视频道信息 */
    var TvFields = [
        'ID',
        'YearMonth',
        'Money',
        'IsClean',
        'PressCount',
        'CutCount'
    ];
    var store = new Ext.data.JsonStore(
            {
                id: 'tvliststore',
                url: '/ams/info/UserList',
                root: 'data',
                fields: TvFields
            });

    var sm = new Ext.grid.CheckboxSelectionModel();
    var listView = new Ext.grid.GridPanel(
            {
                store: store,
                multiSelect: true,
                //style: 'margin-top:20px',
                title: '电费收费情况',
                stripeRows: true,
                region: 'center',
                sm: sm,
                height: 200,
                emptyText: '没有节目',
                autoExpandColumn: 'name',
                reserveScrollOffset: true,
                bbar: [
                    {
                        'text': 'excel',
                        iconCls: 'excel'
                    },
                    {
                        'text': 'pdf',
                        iconCls: 'pdf'
                    },
                    {
                        'text': 'txt',
                        iconCls: 'txt',
                        ref: '../delBtn'
                    }
                ],
                columns: [
                    //new Ext.grid.RowNumberer(),
                    sm,
                    {
                        id: 'name',
                        header: '应收年月',
                        dataIndex: 'YearMonth'
                    }, {
                        header: '欠费金额',
                        dataIndex: 'Money',
                        width: 160,
                        sortable: true
                    }, {
                        header: '停电次数',
                        dataIndex: 'IsClean'
                    }, {
                        header: '结清标志',
                        dataIndex: 'PressCount'
                    }, {
                        header: '催费次数',
                        dataIndex: 'CutCount'
                    }],
                getSelectedIds: function () {
                    var ids = [];
                    Ext.each(this.getSelectionModel().getSelections(), function (node) {
                        ids.push(node.get("ID"));
                    });
                    return ids.join(",");
                }
            });

    var systemUpdate = new Ext.TabPanel({
        labelWidth: 85,
        activeTab: 0,
        height:200,
        plain:true,
        style: 'margin-top:15px',
        defaults:{autoScroll: true},
        items:[
            listView
        ]
    });

    var formpanels = new Ext.form.FormPanel({
        region: 'center',
        fileUpload: true,
        autoScroll: true,
        bodyStyle: "padding:20px;",
        items: [
            localcity,
            ManagerSignature,
            systemUpdate,
            //listView,
            PowerVideo
        ]
    });

    formpanels.getForm().load({
        url: 'index.php?r=config/data',
        success: function (form, action) {
            var type = action.result.data.TvType;

            Ext.getCmp("StandbyImg").setDisabled(type == 0);
            Ext.getCmp("backimg").setDisabled(type == 0);
            Ext.getCmp("StandbyVideo").setDisabled(type == 1);
            Ext.getCmp("backVideo").setDisabled(type == 1);

        },
        failure: function (form, action) {
            //ExtError("系统提示", action.result.errorMessage);
        }
    });


    new Ext.Viewport(
            {
                layout: 'border',
                items: [
                    searchPanel
                ]
            });

});

</script>